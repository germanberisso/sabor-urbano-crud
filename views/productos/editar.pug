extends ../layout

block content
  - var page = ''
  
  .row.mb-4
    .col-12
      h1.display-6
        i.fas.fa-edit.text-warning.me-3
        | Editar Producto

  .row
    .col-lg-6
      .card
        .card-body
          if producto
            form#productoForm(action=`/api/productos/${producto.id}`, method="POST")
              input(type="hidden", name="_method", value="PUT")
              .mb-3
                label.form-label(for="nombre") Nombre
                input.form-control(type="text", id="nombre", name="nombre", value=producto.nombre, required)
              .mb-3
                label.form-label(for="precio") Precio
                input.form-control(type="number", id="precio", name="precio", value=producto.precio, required)
              .form-group
                label(for="stock") Stock
                select.form-control(name="stock")
                  option(value="true" selected=producto && producto.stock) Disponible
                  option(value="false" selected=producto && !producto.stock) No disponible

              .d-grid
                button.btn.btn-warning(type="submit")
                  i.fas.fa-save.me-2
                  | Actualizar Producto
          else
            .alert.alert-danger
              i.fas.fa-exclamation-triangle.me-2
              | Producto no encontrado
      a.btn.btn-outline-secondary.mt-3(href="/productos")
        i.fas.fa-arrow-left.me-2
        | Volver
    script.
      document.getElementById('productoForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData);
        //if (!data.unidadMedida) delete data.unidadMedida;
        //if (!data.proveedor) delete data.proveedor;
        try {
          const response = await fetch(`/api/productos/${#{producto.id}}`, {
            method: data._method || 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(Object.fromEntries(Object.entries(data).filter(([key]) => key !== '_method')))
          });
          const result = await response.json();
          if (result.success) {
            alert('Producto actualizado exitosamente');
            window.location.href = '/productos';
          } else {
            alert(`Error: ${result.message}`);
          }
        } catch (error) {
          alert('Error al actualizar el producto');
        }
      });